<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>PixelNeRF Render</title>
    <style>
        body { margin: 0; font-family: sans-serif; background: #111; color: #eee; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .layout { display: flex; gap: 28px; align-items: flex-start; flex-wrap: wrap; justify-content: center; }
        .card { background: #1c1c1c; padding: 24px; border-radius: 12px; width: 420px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
        h1 { margin: 0 0 12px 0; font-size: 1.4rem; }
        p { margin: 0 0 16px 0; color: #bbb; }
        .upload { border: 2px dashed #444; padding: 18px; text-align: center; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .upload:hover { border-color: #6b7bff; background: #181818; }
        input[type="file"] { display: none; }
        .files { margin-top: 10px; font-size: 0.9rem; color: #ccc; }
        .file-item { padding: 6px 8px; background: #222; border-radius: 6px; margin-top: 6px; }
        button { margin-top: 14px; width: 100%; padding: 12px; background: #6b7bff; border: none; color: white; border-radius: 8px; font-weight: 700; cursor: pointer; }
        button:disabled { background: #444; cursor: not-allowed; }
        #status { margin-top: 12px; color: #bbb; font-size: 0.9rem; }
        #output { margin-top: 12px; text-align: center; }
        #output img { max-width: 520px; max-height: 520px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); display: none; }
        .preview-panel { background: #1c1c1c; padding: 16px; border-radius: 12px; min-width: 360px; max-width: 560px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
        .preview-title { margin: 0 0 10px 0; color: #ccc; font-size: 0.95rem; letter-spacing: 0.02em; }
    </style>
</head>
<body>
    <div class="layout">
        <div class="card">
            <h1>PixelNeRF Render</h1>
            <p>Upload one or more views of the same object. The server returns a spinning GIF.</p>

            <label class="upload" for="fileInput">Click to select image(s)</label>
            <input id="fileInput" type="file" accept="image/*" multiple />

            <div class="files" id="fileList"></div>

            <button id="renderBtn" disabled>Generate GIF</button>
            <div id="status"></div>
        </div>

        <div class="preview-panel">
            <div class="preview-title">Preview</div>
            <div id="output">
                <img id="outputGif" alt="Generated GIF" />
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const renderBtn = document.getElementById('renderBtn');
        const statusEl = document.getElementById('status');
        const outputGif = document.getElementById('outputGif');

        let files = [];

        fileInput.addEventListener('change', (e) => {
            files = Array.from(e.target.files || []);
            fileList.innerHTML = files.length
                ? files.map(f => `<div class="file-item">${f.name}</div>`).join('')
                : '';
            renderBtn.disabled = files.length === 0;
            outputGif.style.display = 'none';
            statusEl.textContent = '';
        });

        const apiBase = (() => {
            const host = window.location.hostname || 'localhost';
            return `http://${host}:8000`;
        })();

        renderBtn.addEventListener('click', async () => {
            if (!files.length) return;

            renderBtn.disabled = true;
            statusEl.textContent = 'Rendering...';
            outputGif.style.display = 'none';

            const formData = new FormData();
            files.forEach(f => formData.append('files', f));

            try {
                const res = await fetch(`${apiBase}/reconstruct`, {
                    method: 'POST',
                    body: formData
                });

                if (!res.ok) {
                    const text = await res.text();
                    throw new Error(`Server responded ${res.status}: ${text}`);
                }

                const blob = await res.blob();
                const url = URL.createObjectURL(blob);
                outputGif.src = url;
                outputGif.style.display = 'block';
                statusEl.textContent = 'Done';
            } catch (err) {
                statusEl.textContent = `Error: ${err.message}`;
            } finally {
                renderBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

